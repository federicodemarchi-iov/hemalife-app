<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#005495">
<title>HemaLife - IOV</title>
<script>
// Generazione Icona PWA Dinamica
const ic=document.createElement('canvas');ic.width=512;ic.height=512;const ix=ic.getContext('2d');
const ig=ix.createLinearGradient(0,0,512,512);ig.addColorStop(0,'#005495');ig.addColorStop(1,'#003366');
ix.fillStyle=ig;ix.beginPath();ix.roundRect(0,0,512,512,96);ix.fill();
ix.fillStyle='#fff';ix.beginPath();ix.moveTo(256,100);ix.bezierCurveTo(256,100,155,225,155,305);
ix.bezierCurveTo(155,360,200,410,256,410);ix.bezierCurveTo(312,410,357,360,357,305);
ix.bezierCurveTo(357,225,256,100,256,100);ix.fill();
ix.fillStyle='#005495';ix.fillRect(240,240,32,80);ix.fillRect(224,264,64,32);
const iu=ic.toDataURL('image/png');
const l1=document.createElement('link');l1.rel='apple-touch-icon';l1.href=iu;document.head.appendChild(l1);
const l2=document.createElement('link');l2.rel='icon';l2.type='image/png';l2.href=iu;document.head.appendChild(l2);
</script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root { --iov-blue: #005495; --iov-dark: #003366; --bg: #F1F5F9; --text: #1E293B; }
body { margin:0; font-family:'DM Sans',sans-serif; background:var(--bg); color:var(--text); -webkit-font-smoothing: antialiased; }
.header { background:white; padding:15px; text-align:center; border-bottom:3px solid var(--iov-blue); position:sticky; top:0; z-index:100; box-shadow:0 2px 10px rgba(0,0,0,0.05); }
.header img { height:35px; }
.container { padding:15px; max-width:600px; margin:0 auto; padding-bottom:100px; }
.card { background:white; border-radius:20px; padding:20px; margin-bottom:15px; border:1px solid #E2E8F0; box-shadow:0 4px 6px rgba(0,0,0,0.02); }
.btn { border:none; border-radius:12px; padding:14px; font-weight:700; width:100%; cursor:pointer; font-size:16px; transition:0.2s; display:flex; align-items:center; justify-content:center; gap:8px; text-decoration:none; margin-bottom:10px; }
.bp { background: linear-gradient(135deg, var(--iov-blue), var(--iov-dark)); color:white; }
.bs { background:#E2E8F0; color:#475569; }
.lb { font-size:12px; font-weight:700; color:#64748B; text-transform:uppercase; margin-bottom:8px; display:block; }
input { width:100%; padding:12px; border:1.5px solid #CBD5E1; border-radius:10px; font-size:16px; margin-bottom:15px; box-sizing: border-box; }
.nav { position:fixed; bottom:0; left:0; right:0; background:white; display:flex; border-top:1px solid #E2E8F0; padding:10px 0 25px; justify-content:space-around; z-index:1000; }
.nav-item { font-size:10px; font-weight:700; color:#64748B; text-align:center; flex:1; cursor:pointer; }
.nav-item.active { color:var(--iov-blue); }
</style>
</head>
<body>
<div id="root"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.3.1/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.3.1/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.26.9/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.12.7/Recharts.min.js"></script>

<script type="text/babel">
const { useState, useEffect } = React;
// Estrazione componenti Recharts
const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } = window.Recharts;

const S = {
  get: (k, d) => { try { const v = localStorage.getItem(k); return v ? JSON.parse(v) : d; } catch { return d; } },
  set: (k, v) => localStorage.setItem(k, JSON.stringify(v))
};

function App() {
  const [view, setView] = useState('home');
  const [paziente, setPaziente] = useState(S.get('paziente', 'Paziente'));
  const [valori, setValori] = useState(S.get('valori', []));
  const [tempHb, setTempHb] = useState('');

  const salvaDato = () => {
    if(!tempHb) return;
    const nuovoDato = {
      data: new Date().toLocaleDateString('it-IT', {day:'2-digit', month:'2-digit'}), 
      hb: parseFloat(tempHb)
    };
    const nuoviValori = [...valori, nuovoDato].slice(-10); // Tiene ultimi 10
    setValori(nuoviValori);
    S.set('valori', nuoviValori);
    setTempHb('');
    setView('home');
  };

  return (
    <div style={{minHeight:'100vh'}}>
      <div className="header">
        <img src="https://www.iov.veneto.it/wp-content/themes/iov/img/logo-iov.png" alt="IOV Logo" />
        <div style={{fontSize:'11px', fontWeight:700, color:'var(--iov-blue)', textTransform:'uppercase'}}>HemaLife - Area Paziente</div>
      </div>

      <div className="container">
        {view === 'home' && (
          <div className="anim">
            <div className="card">
              <h2 style={{margin:0, color:'var(--iov-blue)'}}>Buongiorno, {paziente}</h2>
              <p style={{fontSize:'14px', color:'#64748B'}}>Oggi √® il {new Date().toLocaleDateString('it-IT')}</p>
            </div>

            <div className="card">
              <span className="lb">Azioni Veloci</span>
              <button className="btn bp" onClick={() => setView('esami')}>ü©∏ Inserisci Emoglobina</button>
            </div>

            <div className="card">
              <span className="lb">Andamento Emoglobina (Hb)</span>
              <div style={{height: 220, width: '100%', marginTop: 10}}>
                {valori.length > 0 ? (
                  <ResponsiveContainer width="100%" height="100%">
                    <LineChart data={valori}>
                      <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#eee" />
                      <XAxis dataKey="data" tick={{fontSize: 10}} />
                      <YAxis domain={['auto', 'auto']} tick={{fontSize: 10}} />
                      <Tooltip />
                      <Line type="monotone" dataKey="hb" stroke="#005495" strokeWidth={3} dot={{r:6}} activeDot={{r:8}} />
                    </LineChart>
                  </ResponsiveContainer>
                ) : (
                  <div style={{textAlign:'center', color:'#94a3b8', paddingTop:60}}>Nessun dato inserito</div>
                )}
              </div>
            </div>
          </div>
        )}

        {view === 'esami' && (
          <div className="card">
            <h3>Nuova Rilevazione</h3>
            <span className="lb">Valore Emoglobina (g/dL)</span>
            <input 
              type="number" 
              step="0.1" 
              placeholder="es. 12.5" 
              value={tempHb} 
              onChange={(e) => setTempHb(e.target.value)} 
            />
            <button className="btn bp" onClick={salvaDato}>Salva nel Diario</button>
            <button className="btn bs" onClick={() => setView('home')}>Annulla</button>
          </div>
        )}

        {view === 'settings' && (
          <div className="card">
            <h3>Impostazioni Profilo</h3>
            <span className="lb">Nome e Cognome</span>
            <input 
              type="text" 
              value={paziente} 
              onChange={(e) => {setPaziente(e.target.value); S.set('paziente', e.target.value)}} 
            />
            <button className="btn bp" onClick={() => setView('home')}>Torna alla Home</button>
            <button className="btn bs" style={{color:'red'}} onClick={() => {if(confirm('Cancellare i dati?')){localStorage.clear(); location.reload()}}}>Resetta App</button>
          </div>
        )}
      </div>

      <div className="nav">
        <div className={`nav-item ${view==='home'?'active':''}`} onClick={()=>setView('home')}>üè†<br/>Home</div>
        <div className={`nav-item ${view==='esami'?'active':''}`} onClick={()=>setView('esami')}>ü©∏<br/>Esami</div>
        <div className={`nav-item ${view==='settings'?'active':''}`} onClick={()=>setView('settings')}>‚öôÔ∏è<br/>Profilo</div>
      </div>
    </div>
  );
}

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
</script>
</body>
</html>
